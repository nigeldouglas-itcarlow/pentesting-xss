# Cross Site Scripting (XSS) Penetration Testing
The goal is to fix 11 PHP webpages that could easily be exploited by Cross-Site Scripting (XSS).

| XSS Vulnerability  | Source PHP | Fixed PHP Code | Description of Change |
| ------------- | ------------- | ------------- | ------------- |
| Reflective XSS Over GET  | [Lab01.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/lab01.php)  | [lab01-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab01-fixed.php)  | The code first uses htmlspecialchars to escape HTML entities in the user-provided input stored in the "name" parameter, preventing the execution of any HTML or script tags. Then, it echoes the sanitized input, ensuring that any potential XSS payloads are displayed as harmless text rather than being executed as code.  |
| Reflective XSS Over GET  | [Lab02.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab02.php)  | [Lab02-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/Lab02-fixed.php)  | These two lines of code use htmlspecialchars with the ENT_QUOTES flag and specify the character encoding as UTF-8 to escape both single and double quotes in the user-provided input, making it resistant to HTML and attribute-based XSS attacks. Then, it echoes the sanitized input, ensuring that any potential XSS payloads are displayed as harmless text rather than being executed as code.  |
| Reflective XSS Over GET  | [Lab03.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab03.php)  | [lab03-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab03-fixed.php)  | Lab3.php is almost identical to Lab2.php in the sense that they only removed the line - <b>$name = $_GET["name"];</b> Same code in Lab2-fixed.php prevented same payload.  |
| Reflective XSS Over GET  | [Lab04.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab04.php)  | [lab04-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab04-fixed.php)  | This code first uses strip_tags to remove any HTML tags from the user input, allowing only specified safe tags like < b >, < i >, < u >, and < p > to remain. Then, it applies htmlspecialchars with the ENT_QUOTES flag and UTF-8 encoding to escape special characters, ensuring that even if tags are present, they won't be executed as code.  |
| Reflective XSS Over GET  | [Lab05.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab05.php)  | [lab05-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab05-fixed.php)  | Lab4.php blocked 'script' and 'img' tags. Lab5.php is the same except is also blocks 'alert' tags. I bypass that by obfuscating the payload, but the actual code fix for Lab4.php is identical to Lab5.php. Same 3 lines of PHP code prevented the obfuscated XSS payload by first using strip_tags to remove any HTML tags not explicitly allowed before employing htmlspecialchars to escape special characters, rendering the payload harmless.   |
| Reflective XSS Over POST  | [Lab06.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab06.php)  | [lab06-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab06-fixed.php)  | As we have done thus far, our PHP sanitization controls use the htmlspecialchars function with the ENT_QUOTES flag to convert characters like < and > into their HTML entity equivalents. This encoding prevents the <script>alert("XSS")</script> payload from being interpreted as HTML and executed as JS.  |
| DOM XSS Over HTTP GET  | [Lab07.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab07.php)  | [lab07-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab07-fixed.php)  | This attack was a no-PHP (only JS approach). The JS code I used in the fix doesn't inherently prevent the payload I used; instead, it processed the payload as text content and appended it to the HTML body. In future, if an attacker passes #<script>alert("XSS")</script> as the fragment identifier (#) in the URL, the JS code extracts it from the location.hash, creates a new div element, sets its text content to the extracted value (#<script>alert("XSS")</script>), and appends this content as a child of the body element. This results in the payload being displayed as text on the webpage rather than executing it as a script.  |
| Reflective XSS Over POST  | [Lab08.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab08.php)  | [lab08-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab08-fixed.php)  | This was another HTTP POST scenario in the form being sent to the server via $_POST["TX_name"]. In my fixed code, I immediately applied htmlspecialchars($_POST["TX_name"], ENT_QUOTES, 'UTF-8') to the input value to prevent this type of XSS attack.  |
| Reflective XSS Over GET  | [Lab09.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab09.php)  | [lab09-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab09-fixed.php)  | Content Cell  |
| Reflective XSS Over POST  | [Lab10.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab10.php)  | [lab10-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/lab10-fixed.php)  | Content Cell  |
| Reflective XSS Over GET  | [Lab11.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/original-src-files/Lab11.php) | [lab11-fixed.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/Lab11-fixed.php)  | The payload from Lab10 worked on Lab11. Realized that echo $_GET["name"]; was actually blocking the RemoveXSS function on GET "name". As a result, in the fixed version in commented out the echo on GET name, but this enforced the RemoveXSS function in [FilterHeader.php](https://github.com/nigeldouglas-itcarlow/pentesting-xss/blob/main/FilterHeader.php).  |

## Successfully Tested Payloads

Lab01.php
```
?name=<script>alert(123)</script>
```

Lab02.php
```
?name=<img%20src=x%20onerror=alert("XSS")>
```

Lab03.php (Same as Lab2.php)
```
?name=<img%20src=x%20onerror=alert("XSS")
```

Lab04.php
```
?name="><svg%20onload=alert("XSS")>
```

Lab05.php
```
?name=%22%3E%3Csvg/onload=eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))>
```

Lab06.php
```
<script>alert("XSS")</script>
```

Lab07.php
```
#<script>alert("XSS")</script>
```

Lab08.php
```
?TX_name=Nigel"><script>alert("XSS")</script>
```

Lab09.php
```
?number=10); alert('XSS');//
```

Lab10.php
```
Nigel"><s``ript>ale``rt``('Nigelâ€™s Cross Site Scripting')</scri``pt>
```

Lab11.php (Currently does not work)
```
?name=<script>alert('XSS')</script>
```

## Comparing my findings using Zap Proxy

I had to compare the manual findings with those identified in my OWASP Zap report. <br/>
However, I'm still unsure how to use the findings of this tool to mitigate XSS attacks:

![zap-report1](https://github.com/nigeldouglas-itcarlow/pentesting-xss/assets/126002808/5555a3f7-dc59-46f4-9ce1-4c17005281d4)

## Used ChatGPT to identify gaps
The sanitization efforts had large arrays of keywords and tags that are blocked.
I was able to identify <svg> and the "typeof" attribut that were not listed in the PHP controls:

![fields not listed](https://github.com/nigeldouglas-itcarlow/pentesting-xss/assets/126002808/29ba2547-2739-4cb4-afe7-c6dd629f7202)


